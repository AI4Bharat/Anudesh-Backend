# Generated by Django 3.2.14 on 2023-04-16 05:54

from django.db import migrations
from dataset.models import TranslationPair, SentenceText
from tqdm import tqdm


def populate_translation_pair_domain_field(apps, schema_editor):
    tp_list = []
    for tp in TranslationPair.objects.all().iterator():
        tp1 = tp
        while not (tp1.parent_data == None):
            tp1 = tp1.parent_data
            st = SentenceText.objects.filter(id=tp1.id)
            if len(st) > 0:
                setattr(tp, "domain", st[0].domain)
                tp_list.append(tp)
                break
        if len(tp_list) == 2048:
            TranslationPair.objects.bulk_update(tp_list, ["domain"])
            tp_list.clear()
            print(tp.id)


class Migration(migrations.Migration):
    dependencies = [
        ("dataset", "0037_translationpair_domain"),
    ]

    operations = [
        migrations.RunPython(populate_translation_pair_domain_field),
    ]
